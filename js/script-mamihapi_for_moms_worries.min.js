function parseApiJson(t){if("string"!=typeof t)return t;let e=t.trim();return e&&65279===e.charCodeAt(0)&&(e=e.slice(1)),e=e.replace(/\/\/[^\n\r]*/g,"").replace(/\/\*[\s\S]*?\*\//g,""),e=e.replace(/,\s*(?=[}\]])/g,""),JSON.parse(e)}function addCart(){const t=new Set;$(".addToCart").each(function(){const e=$(this).data("products");null!=e&&""!==String(e).trim()&&t.add(String(e).trim().toUpperCase())}),$(".addToCart-multiple").each(function(){String($(this).data("products")||"").split(",").map(t=>String(t||"").trim()).filter(Boolean).forEach(e=>t.add(e.toUpperCase()))}),$(".lineup_item_price").each(function(){const e=$(this).data("product");null!=e&&""!==String(e).trim()&&t.add(String(e).trim().toUpperCase())});const e=Array.from(t);0!==e.length&&$.ajax({url:"https://h15yyu8zof.execute-api.ap-northeast-1.amazonaws.com/prod/get_product_list_add_data",type:"POST",contentType:"application/json",dataType:"text",processData:!1,headers:{Accept:"application/json"},data:JSON.stringify({skus:e})}).done(function(t){let e;try{e=parseApiJson(t)}catch(e){return void console.error("API response JSON parse failed:",e,t)}var a=[];e&&Array.isArray(e.items)?a=e.items:e&&Array.isArray(e.data)?a=e.data:e&&Array.isArray(e.result)&&(a=e.result);const n={};a.forEach(t=>{t&&t.sku_no&&(n[String(t.sku_no).toLowerCase()]=t)}),$(".addToCart").each(function(){const t=$(this),e=t.data("products");if(!e)return;const a=t.data("specifiedname"),o=Number(t.data("image"))||1,i=String(t.data("imagesize")||"s"),s=n[String(e).toLowerCase()];if(!s)return;const r=String(s.sku_no||e),p=r.toUpperCase(),c=Number(s.id);let l=String(s.name||"");const u=Number(s.selling_price||0),d=Number(s.normal_price||0),m=Number(s.thumbnail_number||o),h=r.slice(0,3),g="/c/series/"+h.toLowerCase()+"/"+r.toLowerCase();a&&""!==String(a).trim()&&(l=String(a));let v="";if(u>0&&d>0&&u<d?v='<span class="mark-sale">SALE</span><span class="normalPrice">¥'+d.toLocaleString()+'（税込）</span><span class="sellingPrice">¥'+u.toLocaleString()+"（税込）</span>":u>0&&(v='<span class="sellingPrice">¥'+u.toLocaleString()+"（税込）</span>"),!Number.isFinite(c))return;const f=("000000000000"+c).slice(-12),S=("000"+Math.floor(c/100)).slice(-3),y=("00"+(m||o)).slice(-2),b="https://shiraistore.itembox.design/product/"+S+"/"+f+"/"+f+"-"+y+"-"+i+".jpg";let _="";const C=Array.isArray(s.adis)?s.adis.slice().sort():null;C&&C.length>=3&&(_='<h6>組立サービス</h6><input type="hidden" name="products['+p+'].productOptionsWithPrice[1].id" value="1"/><select name="products['+p+'].productOptionsWithPrice[1].value"><option value="'+C[0][0]+'">'+C[0][1]+"(+"+Number(C[0][2]||0).toLocaleString()+'円 税込)</option><option value="'+C[1][0]+'">'+C[1][1]+"(+"+Number(C[1][2]||0).toLocaleString()+'円 税込)</option><option value="'+C[2][0]+'">'+C[2][1]+"(+"+Number(C[2][2]||0).toLocaleString()+"円 税込)</option></select>"),t.find(".addToCartImage").empty().prepend('<img src="'+b+'">'),t.find(".addToCartInner").empty().prepend('<form action="https://shirai-store.net/p/cart/add" method="post"><h5 class="productName">'+l+'</h5><p class="productPrice"><span>price</span>'+v+'</p><input type="hidden" name="products['+p+'].productNo" value="'+p+'">'+_+'<h6>数量</h6><div class="cartBlock"><select name="products['+p+'].quantity" class="quantitySelect"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option></select><button type="submit">カートに入れる</button></div></form><div class=""><a target="_blank" href="'+g+'">商品詳細を見る</a></div>')}),$(".addToCart-multiple").each(function(){const t=$(this),e=String(t.data("products")||""),a=Number(t.data("image"))||1,o=String(t.data("imagesize")||"s"),i=e.split(",").map(t=>String(t||"").trim()).filter(Boolean);let s=0,r=0,p=0,c=0,l="",u="";i.forEach(t=>{const e=n[String(t).toLowerCase()];if(!e)return;const i=String(e.sku_no||t),d=i.toUpperCase(),m=Number(e.id),h=Number(e.selling_price||0),g=Number(e.normal_price||0),v=Array.isArray(e.adis)?e.adis.slice().sort():null;if(s+=h,r+=g,v&&v.length>=3&&(p+=Number(v[1][2]||0),c+=Number(v[2][2]||0)),Number.isFinite(m)){const t=("000000000000"+m).slice(-12),n=("000"+Math.floor(m/100)).slice(-3),i=("00"+(Number(e.thumbnail_number||a)||1)).slice(-2);u="https://shiraistore.itembox.design/product/"+n+"/"+t+"/"+t+"-"+i+"-"+o+".jpg"}l+='<input type="hidden" name="products['+d+'].productNo" value="'+d+'"><input type="hidden" name="products['+d+'].productOptionsWithPrice[1].id" value="1"/><input class="adisInput" type="hidden" name="products['+d+'].productOptionsWithPrice[1].value" value="'+(v?v[0][0]:"ADIS-00")+'"><input class="quantityInput" type="hidden" name="products['+d+'].quantity" value="1" size="5">'});let d="";s>0&&r>0&&s<r?d='<p class="productPrice"><span>price</span><span class="mark-sale">SALE</span><span class="normalPrice">¥'+r.toLocaleString()+'（税込）</span><span class="sellingPrice">¥'+s.toLocaleString()+"（税込）</span></p>":s>0&&(d='<p class="productPrice"><span>price</span><span class="sellingPrice">¥'+s.toLocaleString()+"（税込）</span></p>"),u&&t.find(".addToCartImage").empty().prepend('<img src="'+u+'">');let m="";(p>0||c>0)&&(m='<h6>組立サービス</h6><select class="adisSelect"><option value="ADIS-00">なし(+0円 税込)</option><option value="ADIS-01">組立済+玄関渡し(+'+p.toLocaleString()+'円 税込)</option><option value="ADIS-02">組立済+搬入(+'+c.toLocaleString()+"円 税込)</option></select>"),t.find(".addToCartInner").prepend(d+m+'<h6>数量</h6><div class="cartBlock"><select class="quantitySelect"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option></select> <form action="https://shirai-store.net/p/cart/add" method="post">'+l+'<button type="submit">カートへ</button></form></div>')}),$(".lineup_item_price").each(function(){const t=$(this),e=t.data("product");if(!e)return;const a=n[String(e).toLowerCase()];if(!a)return;const o=Number(a.selling_price||0),i=Number(a.normal_price||0),s=Math.floor(.9*o);let r="";o>0&&i>0&&o<i?r='<span class="mark-sale">SALE</span><span class="normalPrice">¥'+i.toLocaleString()+'<span class="tax">(税込)</span></span><span class="sellingPrice">¥'+o.toLocaleString()+'<span class="tax">(税込)</span></span>':o>0&&(r='<span class="sellingPrice">¥'+o.toLocaleString()+'<span class="tax">(税込)</span></span>');const p='<span class="coupon_price">¥'+s.toLocaleString()+'<span class="tax">(税込)</span></span>';t.find(".lineup_item_price_inner").prepend('<div><span class="price_section">price</span>'+r+'</div><div><span class="mark-coupon price_section">クーポン利用で10%OFF</span>'+p+"</div>")}),$(document).off("change.addis",".adisSelect").on("change.addis",".adisSelect",function(){const t=$(this).val();$(this).closest(".addToCart-multiple, .addToCart").find(".adisInput").val(t)}),$(document).off("change.qty",".quantitySelect").on("change.qty",".quantitySelect",function(){const t=$(this).val();$(this).closest(".addToCart-multiple, .addToCart").find(".quantityInput").val(t)})}).fail(function(t,e,a){console.error("get_product_list_add_data API error:",e,a,t&&t.responseText)})}$(function(){addCart()}),jQuery(function(t){t(".tab").click(function(){t(".is-active").removeClass("is-active"),t(this).addClass("is-active"),t(".is-show").removeClass("is-show");const e=t(this).index();t(".panel").eq(e).addClass("is-show")})});