function parseApiJson(t){if("string"!=typeof t)return t;let a=t.trim();return 65279===a.charCodeAt(0)&&(a=a.slice(1)),a=a.replace(/\/\/[^\n\r]*/g,"").replace(/\/\*[\s\S]*?\*\//g,""),a=a.replace(/,\s*(?=[}\]])/g,""),JSON.parse(a)}function featurePts(){const t=new Set;$(".addToCart").each(function(){const a=$(this).data("products");null!=a&&""!==String(a).trim()&&t.add(String(a).trim().toUpperCase())}),$(".addToCart-multiple").each(function(){const a=String($(this).data("products")||"").split(",");a.forEach(a=>{const e=String(a||"").trim();e&&t.add(e.toUpperCase())})});const a=Array.from(t);0!==a.length&&$.ajax({url:"https://h15yyu8zof.execute-api.ap-northeast-1.amazonaws.com/prod/get_product_list_add_data",type:"POST",contentType:"application/json",dataType:"text",processData:!1,headers:{Accept:"application/json"},data:JSON.stringify({skus:a})}).done(function(t){let a;try{a=parseApiJson(t)}catch(a){return void console.error("API response JSON parse failed:",a,t)}var e=[];a&&Array.isArray(a.items)?e=a.items:a&&Array.isArray(a.data)?e=a.data:a&&Array.isArray(a.result)&&(e=a.result);const s={};e.forEach(t=>{t&&t.sku_no&&(s[String(t.sku_no).toLowerCase()]=t)}),$(".addToCart").each(function(){const t=$(this),a=t.data("products"),e=t.data("specifiedname"),n=Number(t.data("image"))||1,i=String(t.data("imagesize")||"s");if(!a)return;const r=s[String(a).toLowerCase()];if(!r)return;const o=String(r.sku_no||a),p=o.toUpperCase(),c=Number(r.id);let l=String(r.name||""),d=Number(r.selling_price||0),u=Number(r.normal_price||0);const m=Number(r.thumbnail_number||n),g=o.slice(0,3),h="/c/series/"+g.toLowerCase()+"/"+o.toLowerCase();e&&""!==String(e).trim()&&(l=String(e));let f="";if(d>0&&u>0&&d<u?f='<span class="mark-sale">SALE</span><span class="normalPrice">¥'+u.toLocaleString()+'（税込）</span><span class="sellingPrice">¥'+d.toLocaleString()+'<span class="tax">（税込）</span></span>':d>0&&(f='<span class="sellingPrice">¥'+d.toLocaleString()+'<span class="tax">（税込）</span></span>'),!Number.isFinite(c))return;const S=("000000000000"+c).slice(-12),y=("000"+Math.floor(c/100)).slice(-3),b=("00"+(m||n)).slice(-2),v="https://shiraistore.itembox.design/product/"+y+"/"+S+"/"+S+"-"+b+"-"+i+".jpg";t.find(".addToCartImage").empty().prepend('<img src="'+v+'">');const C='<form action="https://shirai-store.net/p/cart/add" method="post"><h5 class="productName">'+l+'</h5><p class="productPrice"><span>price</span>'+f+'</p><input type="hidden" name="products['+p+'].productNo" value="'+p+'"><h6>数量</h6><div class="cartBlock"><select name="products['+p+'].quantity" class="quantitySelect"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option></select><button type="submit">カートに入れる</button></div></form><div class=""><a href="'+h+'">商品詳細を見る</a></div>';t.find(".addToCartInner").empty().prepend(C)}),$(".addToCart-multiple").each(function(){const t=$(this),a=String(t.data("products")||""),e=String(t.data("quantity")||""),n=Number(t.data("image"))||1,i=String(t.data("imagesize")||"s"),r=a.split(",").map(t=>String(t||"").trim()).filter(Boolean),o=e.split(",").map(t=>Number(String(t||"1").trim())||1);let p=0,c=0,l="";r.forEach((t,a)=>{const e=s[String(t).toLowerCase()];if(!e)return;const r=null!=o[a]?o[a]:1,d=Number(e.selling_price||0)*r,u=Number(e.normal_price||0)*r;if(p+=d,c+=u,!l&&Number.isFinite(Number(e.id))){const t=Number(e.id),a=("000000000000"+t).slice(-12),s=("000"+Math.floor(t/100)).slice(-3),r=("00"+(Number(e.thumbnail_number||n)||1)).slice(-2);l="https://shiraistore.itembox.design/product/"+s+"/"+a+"/"+a+"-"+r+"-"+i+".jpg"}});let d="";p>0&&c>0&&p<c?d='<p class="productPrice"><span>price</span><span class="mark-sale">SALE</span><span class="normalPrice">¥'+c.toLocaleString()+'<span class="tax">（税込）</span></span><span class="sellingPrice">¥'+p.toLocaleString()+'<span class="tax">（税込）</span></span></p>':p>0&&(d='<p class="productPrice"><span>price</span><span class="sellingPrice">¥'+p.toLocaleString()+'<span class="tax">（税込）</span></span></p>'),l&&t.find(".addToCartImage").empty().prepend('<img src="'+l+'">'),t.find(".addToCartInner").prepend(d)}),$(".quantitySelect").off("change").on("change",function(){const t=$(this).val();$(this).closest(".cartBlock").find(".quantityInput").val(t)})}).fail(function(t,a,e){console.error("get_product_list_add_data API error:",a,e,t&&t.responseText)})}$(function(){featurePts()}),jQuery(function(t){t(".tab").click(function(){t(".is-active").removeClass("is-active"),t(this).addClass("is-active"),t(".is-show").removeClass("is-show");const a=t(this).index();t(".panel").eq(a).addClass("is-show")})});