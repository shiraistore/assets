function parseApiJson(t){if("string"!=typeof t)return t;let a=t.trim();return 65279===a.charCodeAt(0)&&(a=a.slice(1)),a=a.replace(/\/\/[^\n\r]*/g,"").replace(/\/\*[\s\S]*?\*\//g,""),a=a.replace(/,\s*(?=[}\]])/g,""),JSON.parse(a)}function addCart(){const t=Array.from(new Set($(".addToCart").map(function(){const t=$(this).data("products");return null==t?null:String(t).trim()}).get().filter(Boolean)));if(0===t.length)return;const a=t.map(t=>t.toUpperCase());$.ajax({url:"https://h15yyu8zof.execute-api.ap-northeast-1.amazonaws.com/prod/get_product_list_add_data",type:"POST",contentType:"application/json",dataType:"text",processData:!1,headers:{Accept:"application/json"},data:JSON.stringify({skus:a})}).done(function(t){let a;try{a=parseApiJson(t)}catch(a){return void console.error("API response JSON parse failed:",a,t)}var e=[];a&&Array.isArray(a.items)?e=a.items:a&&Array.isArray(a.data)?e=a.data:a&&Array.isArray(a.result)&&(e=a.result);const s={};e.forEach(t=>{t&&t.sku_no&&(s[String(t.sku_no).toLowerCase()]=t)}),$(".addToCart").each(function(){const t=$(this),a=t.data("products"),e=t.data("specifiedname"),r=Number(t.data("image"))||1,o=String(t.data("imagesize")||"s");if(!a)return;const n=s[String(a).toLowerCase()];if(!n)return;const i=String(n.sku_no),l=i.toUpperCase(),d=Number(n.id);let c=String(n.name||"");const p=Number(n.selling_price||0),m=Number(n.normal_price||0),u=Number(n.thumbnail_number||r),g=i.slice(0,3),h="/c/series/"+g.toLowerCase()+"/"+i.toLowerCase();e&&""!==String(e).trim()&&(c=String(e));let f="";if(p>0&&m>0&&p<m?f='<span class="mark-sale">SALE</span><span class="normalPrice">¥'+m.toLocaleString()+'（税込）</span><span class="sellingPrice">¥'+p.toLocaleString()+"（税込）</span>":p>0&&(f='<span class="sellingPrice">¥'+p.toLocaleString()+"（税込）</span>"),!Number.isFinite(d))return;const v=("000000000000"+d).slice(-12),_=("000"+Math.floor(d/100)).slice(-3),P=("00"+(u||r)).slice(-2),y="https://shiraistore.itembox.design/product/"+_+"/"+v+"/"+v+"-"+P+"-"+o+".jpg",b='<img src="'+y+'">',C='<form action="https://shirai-store.net/p/cart/add" method="post" target="_blank"><h5 class="productName">'+c+'</h5><p class="productPrice"><span>price</span>'+f+'</p><input type="hidden" name="products['+l+'].productNo" value="'+l+'"/><h6>数量</h6><div class="cartBlock"><select name="products['+l+'].quantity" class="quantitySelect"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option></select><button type="submit">カートに入れる</button></div></form><div class=""><a target="_blank" href="'+h+'">商品詳細を見る</a></div>';t.find(".addToCartImage").empty().prepend(b),t.find(".addToCartInner").empty().prepend(C)}),$(".quantitySelect").on("change",function(){const t=$(this).val();$(this).closest(".cartBlock").find(".quantityInput").val(t)})}).fail(function(t,a,e){console.error("get_product_list_add_data API error:",a,e,t&&t.responseText)})}function instagramPostList(){$("#momsStorageProblemsAndSolutions").length&&$.getJSON("https://cdn.shirai-store.net/assets/json/common/instagramDisplayPhoto_v1_0.json",function(t){var a="";for(var e in t.reverse()){var s=t[e].postId,r=t[e].thumbnail_url,o=t[e].sizeAdjustment;tag=t[e].tag.split(","),$(".postByAge").each(function(){var t=$(this).data("tag").split(",");a='<li class="modal-open" data-target="instagramPost-modal" data-postid="'+s+'"><img src="'+r+'" style="width:'+o+"%;height:"+o+'%;" alt="instagramPost_'+s+'"></li>',tag.some(function(a){return-1!==t.indexOf(a)})&&$(this).append(a)})}$(".modal-open").on("click",function(){modal_addContent_instagram(t,r,$(this))}),$(".modal-ctr-open").on("click",function(){$(this).hasClass("disable")||($(".modal-content_inner").fadeOut(0),modal_addContent_instagram(t,r,$(this)),$(".modal-content_inner").fadeIn(300))}),modal()})}function modal_addContent_instagram(t,a,e){for(var s=e.data("postid"),r=t.filter(function(t){return t.postId==s}).shift(),o=(a=r.thumbnail_url,r.author_name),n='<div id="imageBox"><a href="https://www.instagram.com/p/'+s+'/" target="_blank"><img width="320" data-src="'+a+'" src="https://shiraistore.itembox.design/item/src/loading.svg" id="thumbnail" class="lazyload" alt="instagramPost_'+s+'"></a><span id="author"><img src="https://shiraistore.itembox.design/item/src/icon-instagram-gr.svg" width="16"><span>Photo by</span><a href=https://www.instagram.com/'+o+' target="_blank">'+o+"</a></span></div>",i="",l=0;r.relatedProduct.length>l;l++){var d=r.relatedProduct[l].productUrl,c=r.relatedProduct[l].productId,p=zeroPadding(r.relatedProduct[l].productId,12),m=Math.floor(c/100),u=r.relatedProduct[l].productName,g=r.relatedProduct[l].categoryLv1,h=parseFloat(r.relatedProduct[l].averageRating),f=r.relatedProduct[l].reviewCount,v=r.relatedProduct[l].sellingPrice,_=r.relatedProduct[l].normalPrice,P=("00"+r.relatedProduct[l].thumbNumber).slice(-2),y=r.relatedProduct[l].icon,b=r.relatedProduct[l].seriesCode.toLowerCase();if(null!=y)var C=y.split(",");var S="";if(""!=C)for(var k=0;C.length>k;k++)icon_splitAry=C[k].split(":"),"mark-sale"==icon_splitAry[0]&&v<_&&(S+='<span class="mark-sale">SALE</span>'),"mark-limitedProduct"==icon_splitAry[0]&&(S+='<span class="mark-limitedProduct">当店限定商品</span>'),"mark-categoryRank"==icon_splitAry[0]&&icon_splitAry[1]<=3&&(S+='<span class="mark-catRank">'+g+" "+icon_splitAry[1]+"位</span>");S='<span class="itemIcon">'+S+"</span>",h<.5?h="0":h<1?h="0.5":h<1.5?h="1.0":h<2?h="1.5":h<2.5?h="2.0":h<3?h="2.5":h<3.5?h="3.0":h<4?h="3.5":h<4.5?h="4.0":h<5?h="4.5":5==h&&(h="5.0");var A="";if(0!=f&&(A='<span class="fs-c-rating__stars fs-c-reviewStars" data-ratingcount="'+h+'"><a target="_blank" href="https://shirai-store.net/f/reviewList?modelCode='+d+'" class="itemReviewCount">（'+f+"）</a></span>"),v=String(v).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),_=String(_).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),v<_)var w='<span class="itemNormalPrice itemPrice">¥ '+_+'<span class="tax">(税込)</span></span><span class="itemSalePrice itemPrice"><span class="sale">特別価格</span> ¥ '+v+'<span class="tax">(税込)</span></span>';else w='<span class="itemPrice">¥ '+v+'<span class="tax">(税込)</span></span>';i=i+'<li class="relatedProductItem"><a target="_blank" href="https://shirai-store.net/c/series/'+b+"/"+d+'"><img data-src="https://shiraistore.itembox.design/product/'+zeroPadding(m,3)+"/"+p+"/"+p+"-"+P+'-s.jpg" alt="instagramPost_'+s+" "+u+'" src="https://shiraistore.itembox.design/item/src/loading.svg" class="lazyload"></a><p><a target="_blank" href="https://shirai-store.net/c/series/'+b+"/"+d+'" class="itemName">'+u+"</a>"+S+A+w+"</li>"}n=n+'<ul id="relatedProductList">'+i+"</ul>",$(".modal-content_inner").html(n),$(".modal-content_inner").fadeIn(300);var x=$(".postedList").children("[data-postid="+s+"]").prev("li").data("postid"),L=$(".postedList").children("[data-postid="+s+"]").next("li").data("postid");null!=x?($("#modal-control").find(".prev").data("postid",x),$("#modal-control").find(".prev").removeClass("disable"),$("#modal-control").find(".prev").addClass("modal-ctr-open")):($("#modal-control").find(".prev").addClass("disable"),$("#modal-control").find(".prev").removeClass("modal-ctr-open")),null!=L?($("#modal-control").find(".next").data("postid",L),$("#modal-control").find(".next").removeClass("disable"),$("#modal-control").find(".next").addClass("modal-ctr-open")):($("#modal-control").find(".next").addClass("disable"),$("#modal-control").find(".next").removeClass("modal-ctr-open"))}$(function(){addCart()}),jQuery(function(t){t(".tab").click(function(){t(".is-active").removeClass("is-active"),t(this).addClass("is-active"),t(".is-show").removeClass("is-show");const a=t(this).index();t(".panel").eq(a).addClass("is-show")})});